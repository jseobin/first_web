{% extends 'admin/layout.html' %}
{% block content %}
<section class="panel">
    <h2>Q&A 관리</h2>
    <div class="list-stack">
        {% for question in questions %}
            <article class="card">
                <div class="row between">
                    <h3>{{ question.title }}</h3>
                    <small>{{ question.created_at }}</small>
                </div>
                <p>{{ question.content }}</p>
                <p class="muted">작성자: {{ question.student_name }} / {{ '공개' if question.is_public else '비공개' }}</p>

                <form method="post" class="form-grid">
                    <input type="hidden" name="action" value="answer">
                    <input type="hidden" name="question_id" value="{{ question.id }}">
                    <label>답변
                        <textarea name="content" rows="3" required></textarea>
                    </label>
                    <button class="btn" type="submit">답변 등록</button>
                </form>

                {% if answers_by_question.get(question.id) %}
                    <div class="answer-list">
                        {% for answer in answers_by_question[question.id] %}
                            <div class="answer-item">
                                <p>{{ answer.content }}</p>
                                <small>{{ answer.admin_name or answer.admin_username }} | {{ answer.created_at }}</small>
                                <form method="post">
                                    <input type="hidden" name="action" value="delete_answer">
                                    <input type="hidden" name="answer_id" value="{{ answer.id }}">
                                    <button class="btn ghost" data-confirm="답변을 삭제할까요?" type="submit">답변 삭제</button>
                                </form>
                            </div>
                        {% endfor %}
                    </div>
                {% endif %}

                <form method="post">
                    <input type="hidden" name="action" value="delete_question">
                    <input type="hidden" name="question_id" value="{{ question.id }}">
                    <button class="btn ghost" data-confirm="질문을 삭제할까요?" type="submit">질문 삭제</button>
                </form>
            </article>
        {% else %}
            <p>등록된 질문이 없습니다.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
